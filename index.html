<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>四字成语</title>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-BQQVDH3FBC"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-BQQVDH3FBC');
    </script>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    <link rel="stylesheet" href="style.css?v=1">
    <script src="https://cdn.jsdelivr.net/npm/pocketbase/dist/pocketbase.umd.js"></script>
    <script src="idiom.js?v=1"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="title-tiles" aria-label="四字成语">
                <span class="title-tile correct">四</span>
                <span class="title-tile absent">字</span>
                <span class="title-tile absent">成</span>
                <span class="title-tile present">语</span>
            </div>
            <div class="subtitle-row">
                <p class="subtitle" id="subtitle"></p>
                <span class="mode-tag" id="modeTag">简单</span>
            </div>
            <button class="stats-btn" id="statsBtn" type="button" title="统计">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="18" y1="20" x2="18" y2="10"></line>
                    <line x1="12" y1="20" x2="12" y2="4"></line>
                    <line x1="6" y1="20" x2="6" y2="14"></line>
                </svg>
            </button>
            <button class="help-btn" id="helpBtn" type="button" title="游玩方式">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <!-- 问号：上弯钩(6字头) + 竖线 + 点 -->
                    <path d="M8 6.5 Q12 4 16 6.5 Q18 9 12 11 L12 14"></path>
                    <circle cx="12" cy="19" r="1.5" fill="currentColor"></circle>
                </svg>
            </button>
            <button class="hint-btn" id="hintBtn" type="button" title="提示">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.8.8 1.3 1.5 1.5 2.5"></path>
                    <path d="M9 18h6"></path>
                    <path d="M10 22h4"></path>
                </svg>
            </button>
            <button class="settings-btn" id="settingsBtn" type="button" title="设置">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="3"></circle>
                    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                </svg>
            </button>
        </header>
        
        <div class="modal-overlay" id="statsModal">
            <div class="modal">
                <div class="modal-header">游戏统计</div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalGames">0</div>
                        <div class="stat-label">已玩</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="winRate">0%</div>
                        <div class="stat-label">胜率</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="currentStreak">0</div>
                        <div class="stat-label">连胜</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="maxStreak">0</div>
                        <div class="stat-label">最高连胜</div>
                    </div>
                </div>
                <div class="guess-distribution">
                    <div class="distribution-title">猜测分布</div>
                    <div id="distributionBars"></div>
                </div>
                <div class="achievement-wall-title">成就</div>
                <div class="achievement-wall" id="achievementWall"></div>
                <button class="modal-btn modal-close-btn" id="statsClose">关闭</button>
            </div>
        </div>
        
        <div class="modal-overlay" id="helpModal">
            <div class="modal help-modal">
                <div class="modal-header">游玩方式</div>
                <div class="help-content">
                    <p class="help-subtitle">猜出成语，你有 <strong>5 次</strong>机会。</p>
                    <ul class="help-rules">
                        <li>每次猜测必须是有效的四字成语</li>
                        <li>提交后，格子颜色会提示你的猜测接近程度</li>
                    </ul>
                    
                    <p class="help-section-title">示例</p>
                    
                    <div class="help-example">
                        <div class="help-tiles">
                            <span class="help-tile correct">龙</span>
                            <span class="help-tile">马</span>
                            <span class="help-tile">精</span>
                            <span class="help-tile">神</span>
                        </div>
                        <p class="help-explain"><strong>龙</strong> 在答案中且位置正确</p>
                    </div>
                    
                    <div class="help-example">
                        <div class="help-tiles">
                            <span class="help-tile">画</span>
                            <span class="help-tile present">龙</span>
                            <span class="help-tile">点</span>
                            <span class="help-tile">睛</span>
                        </div>
                        <p class="help-explain"><strong>龙</strong> 在答案中但位置不对</p>
                    </div>
                    
                    <div class="help-example">
                        <div class="help-tiles">
                            <span class="help-tile">千</span>
                            <span class="help-tile">军</span>
                            <span class="help-tile absent">万</span>
                            <span class="help-tile">马</span>
                        </div>
                        <p class="help-explain"><strong>万</strong> 不在答案中</p>
                    </div>
                    
                    <p class="help-note">每日一题，所有人同一天题目相同。只能使用键盘上的字。</p>
                    <p class="help-author">作者：ØYNN</p>
                </div>
                <button class="modal-btn" id="helpClose">关闭</button>
            </div>
        </div>
        
        <div class="modal-overlay" id="settingsModal">
            <div class="modal settings-modal">
                <div class="modal-header">设置</div>
                <div class="settings-list">
                    <div class="setting-item setting-item-cloud">
                        <span class="setting-label">云端同步</span>
                        <span class="setting-desc">密钥为空时点击「生成密钥」创建并保存；已有密钥时点击「同步数据」与云端同步。</span>
                        <input type="text" id="settingAuthKey" placeholder="输入密钥或点击生成" autocomplete="off">
                        <div class="setting-key-btns">
                            <button type="button" class="modal-btn modal-btn-key" id="settingKeyBtn">生成密钥</button>
                        </div>
                        <div class="setting-key-reset" id="settingKeyResetContainer" style="display: none;">
                            <button type="button" class="modal-btn modal-btn-reset" id="settingKeyResetBtn">重置密钥</button>
                        </div>
                    </div>
                    <label class="setting-item">
                        <span class="setting-label">提示非成语</span>
                        <span class="setting-desc">关闭后，不是成语也可以提交</span>
                        <input type="checkbox" id="settingValidateIdiom">
                        <span class="toggle"></span>
                    </label>
                    <label class="setting-item">
                        <span class="setting-label">键盘高亮</span>
                        <span class="setting-desc">关闭后，不显示已猜字状态</span>
                        <input type="checkbox" id="settingKeyboardHighlight" checked>
                        <span class="toggle"></span>
                    </label>
                    <label class="setting-item setting-item-disabled">
                        <span class="setting-label">简单模式</span>
                        <span class="setting-desc">当日答案只从常用成语中选取</span>
                        <input type="checkbox" id="settingCommonIdiomOnly" checked disabled>
                        <span class="toggle"></span>
                    </label>
                </div>
                <button class="modal-btn" id="settingsClose">关闭</button>
            </div>
        </div>
        
        <div class="modal-overlay" id="resultModal">
            <div class="modal">
                <div class="modal-header" id="modalHeader">恭喜你猜对了！</div>
                <div class="modal-word" id="resultWord"></div>
                <div class="modal-pinyin" id="resultPinyin"></div>
                <div class="modal-explanation" id="resultExplanation"></div>
                <div class="modal-derivation" id="resultDerivation"></div>
                <div class="modal-achievement-unlock" id="resultAchievementUnlock" style="display: none;"></div>
                <div class="modal-buttons">
                    <button class="modal-btn modal-share" id="shareBtn">分享结果</button>
                    <button class="modal-btn modal-close-btn" id="modalClose">关闭</button>
                </div>
            </div>
        </div>

        <div class="game-board" id="gameBoard">
            <!-- 6 rows, each with 4 tiles -->
        </div>

        <div class="keyboard" id="keyboard">
            <!-- 虚拟键盘将由 JS 生成 -->
        </div>

        <div class="message" id="message"></div>
    </div>

    <script src="script.js?v=1"></script>
</body>
</html>
